!function(){"use strict";var a=function(b){function c(a,b,c,d){var f;return a.isFile?a.file(function(a){a.relativePath=b+a.name,c.push(a),d()}):(a.isDirectory?f=a:a instanceof File&&c.push(a),"function"==typeof a.webkitGetAsEntry&&(f=a.webkitGetAsEntry()),f&&f.isDirectory?e(f,b+f.name+"/",c,d):("function"==typeof a.getAsFile&&(a=a.getAsFile())instanceof File&&(a.relativePath=b+a.name,c.push(a)),void d()))}function d(a,b){if(!a||0===a.length)return b();a[0](function(){d(a.slice(1),b)})}function e(a,b,e,f){a.createReader().readEntries(function(a){if(!a.length)return f();d(a.map(function(a){return c.bind(null,a,b,e)}),f)})}function f(a,b){if(a.length){i.fire("beforeAdd");var e=[];d(Array.prototype.map.call(a,function(a){return c.bind(null,a,"",e)}),function(){e.length&&m(e,b)})}}function g(a,b,c){var d=this;d.opts={},d.getOpt=a.getOpt,d._prevProgress=0,d.resumableObj=a,d.file=b,d.fileName=b.fileName||b.name,d.size=b.size,d.relativePath=b.relativePath||b.webkitRelativePath||d.fileName,d.uniqueIdentifier=c,d._pause=!1,d.container="";var e=void 0!==c,f=function(a,b){switch(a){case"progress":d.resumableObj.fire("fileProgress",d,b);break;case"error":d.abort(),e=!0,d.chunks=[],d.resumableObj.fire("fileError",d,b);break;case"success":if(e)return;d.resumableObj.fire("fileProgress",d),d.isComplete()&&d.resumableObj.fire("fileSuccess",d,b);break;case"retry":d.resumableObj.fire("fileRetry",d)}};return d.chunks=[],d.abort=function(){var a=0;j.each(d.chunks,function(b){"uploading"==b.status()&&(b.abort(),a++)}),a>0&&d.resumableObj.fire("fileProgress",d)},d.cancel=function(){var a=d.chunks;d.chunks=[],j.each(a,function(a){"uploading"==a.status()&&(a.abort(),d.resumableObj.uploadNextChunk())}),d.resumableObj.removeFile(d),d.resumableObj.fire("fileProgress",d)},d.retry=function(){d.bootstrap();var a=!1;d.resumableObj.on("chunkingComplete",function(){a||d.resumableObj.upload(),a=!0})},d.bootstrap=function(){d.abort(),e=!1,d.chunks=[],d._prevProgress=0;for(var a=d.getOpt("forceChunkSize")?Math.ceil:Math.floor,b=Math.max(a(d.file.size/d.getOpt("chunkSize")),1),c=0;c<b;c++)!function(a){window.setTimeout(function(){d.chunks.push(new h(d.resumableObj,d,a,f)),d.resumableObj.fire("chunkingProgress",d,a/b)},0)}(c);window.setTimeout(function(){d.resumableObj.fire("chunkingComplete",d)},0)},d.progress=function(){if(e)return 1;var a=0,b=!1;return j.each(d.chunks,function(c){"error"==c.status()&&(b=!0),a+=c.progress(!0)}),a=b?1:a>.99999?1:a,a=Math.max(d._prevProgress,a),d._prevProgress=a,a},d.isUploading=function(){var a=!1;return j.each(d.chunks,function(b){if("uploading"==b.status())return a=!0,!1}),a},d.isComplete=function(){var a=!1;return j.each(d.chunks,function(b){var c=b.status();if("pending"==c||"uploading"==c||1===b.preprocessState)return a=!0,!1}),!a},d.pause=function(a){d._pause=void 0===a?!d._pause:a},d.isPaused=function(){return d._pause},d.resumableObj.fire("chunkingStart",d),d.bootstrap(),this}function h(a,b,c,d){var e=this;e.opts={},e.getOpt=a.getOpt,e.resumableObj=a,e.fileObj=b,e.fileObjSize=b.size,e.fileObjType=b.file.type,e.offset=c,e.callback=d,e.lastProgressCallback=new Date,e.tested=!1,e.retries=0,e.pendingRetry=!1,e.preprocessState=0;var f=e.getOpt("chunkSize");return e.loaded=0,e.startByte=e.offset*f,e.endByte=Math.min(e.fileObjSize,(e.offset+1)*f),e.fileObjSize-e.endByte<f&&!e.getOpt("forceChunkSize")&&(e.endByte=e.fileObjSize),e.xhr=null,e.test=function(){e.xhr=new XMLHttpRequest;var a=function(a){e.tested=!0;var b=e.status();"success"==b?(e.callback(b,e.message()),e.resumableObj.uploadNextChunk()):e.send()};e.xhr.addEventListener("load",a,!1),e.xhr.addEventListener("error",a,!1),e.xhr.addEventListener("timeout",a,!1);var b=[],c=e.getOpt("parameterNamespace"),d=e.getOpt("query");"function"==typeof d&&(d=d(e.fileObj,e)),j.each(d,function(a,d){b.push([encodeURIComponent(c+a),encodeURIComponent(d)].join("="))}),b=b.concat([["chunkNumberParameterName",e.offset+1],["chunkSizeParameterName",e.getOpt("chunkSize")],["currentChunkSizeParameterName",e.endByte-e.startByte],["totalSizeParameterName",e.fileObjSize],["typeParameterName",e.fileObjType],["identifierParameterName",e.fileObj.uniqueIdentifier],["fileNameParameterName",e.fileObj.fileName],["relativePathParameterName",e.fileObj.relativePath],["totalChunksParameterName",e.fileObj.chunks.length]].filter(function(a){return e.getOpt(a[0])}).map(function(a){return[c+e.getOpt(a[0]),encodeURIComponent(a[1])].join("=")})),e.xhr.open(e.getOpt("testMethod"),j.getTarget("test",b)),e.xhr.timeout=e.getOpt("xhrTimeout"),e.xhr.withCredentials=e.getOpt("withCredentials");var f=e.getOpt("headers");"function"==typeof f&&(f=f(e.fileObj,e)),j.each(f,function(a,b){e.xhr.setRequestHeader(a,b)}),e.xhr.send(null)},e.preprocessFinished=function(){e.preprocessState=2,e.send()},e.send=function(){var a=e.getOpt("preprocess");if("function"==typeof a)switch(e.preprocessState){case 0:return e.preprocessState=1,void a(e);case 1:return}if(e.getOpt("testChunks")&&!e.tested)return void e.test();e.xhr=new XMLHttpRequest,e.xhr.upload.addEventListener("progress",function(a){new Date-e.lastProgressCallback>1e3*e.getOpt("throttleProgressCallbacks")&&(e.callback("progress"),e.lastProgressCallback=new Date),e.loaded=a.loaded||0},!1),e.loaded=0,e.pendingRetry=!1,e.callback("progress");var b=function(a){var b=e.status();if("success"==b||"error"==b)e.callback(b,e.message()),e.resumableObj.uploadNextChunk();else{e.callback("retry",e.message()),e.abort(),e.retries++;var c=e.getOpt("chunkRetryInterval");void 0!==c?(e.pendingRetry=!0,setTimeout(e.send,c)):e.send()}};e.xhr.addEventListener("load",b,!1),e.xhr.addEventListener("error",b,!1),e.xhr.addEventListener("timeout",b,!1);var c=[["chunkNumberParameterName",e.offset+1],["chunkSizeParameterName",e.getOpt("chunkSize")],["currentChunkSizeParameterName",e.endByte-e.startByte],["totalSizeParameterName",e.fileObjSize],["typeParameterName",e.fileObjType],["identifierParameterName",e.fileObj.uniqueIdentifier],["fileNameParameterName",e.fileObj.fileName],["relativePathParameterName",e.fileObj.relativePath],["totalChunksParameterName",e.fileObj.chunks.length]].filter(function(a){return e.getOpt(a[0])}).reduce(function(a,b){return a[e.getOpt(b[0])]=b[1],a},{}),d=e.getOpt("query");"function"==typeof d&&(d=d(e.fileObj,e)),j.each(d,function(a,b){c[a]=b});var f=e.fileObj.file.slice?"slice":e.fileObj.file.mozSlice?"mozSlice":e.fileObj.file.webkitSlice?"webkitSlice":"slice",g=e.fileObj.file[f](e.startByte,e.endByte,e.getOpt("setChunkTypeFromFile")?e.fileObj.file.type:""),h=null,i=[],k=e.getOpt("parameterNamespace");if("octet"===e.getOpt("method"))h=g,j.each(c,function(a,b){i.push([encodeURIComponent(k+a),encodeURIComponent(b)].join("="))});else if(h=new FormData,j.each(c,function(a,b){h.append(k+a,b),i.push([encodeURIComponent(k+a),encodeURIComponent(b)].join("="))}),"blob"==e.getOpt("chunkFormat"))h.append(k+e.getOpt("fileParameterName"),g,e.fileObj.fileName);else if("base64"==e.getOpt("chunkFormat")){var l=new FileReader;l.onload=function(a){h.append(k+e.getOpt("fileParameterName"),l.result),e.xhr.send(h)},l.readAsDataURL(g)}var m=j.getTarget("upload",i),n=e.getOpt("uploadMethod");e.xhr.open(n,m),"octet"===e.getOpt("method")&&e.xhr.setRequestHeader("Content-Type","application/octet-stream"),e.xhr.timeout=e.getOpt("xhrTimeout"),e.xhr.withCredentials=e.getOpt("withCredentials");var o=e.getOpt("headers");"function"==typeof o&&(o=o(e.fileObj,e)),j.each(o,function(a,b){e.xhr.setRequestHeader(a,b)}),"blob"==e.getOpt("chunkFormat")&&e.xhr.send(h)},e.abort=function(){e.xhr&&e.xhr.abort(),e.xhr=null},e.status=function(){return e.pendingRetry?"uploading":e.xhr?e.xhr.readyState<4?"uploading":200==e.xhr.status||201==e.xhr.status?"success":j.contains(e.getOpt("permanentErrors"),e.xhr.status)||e.retries>=e.getOpt("maxChunkRetries")?"error":(e.abort(),"pending"):"pending"},e.message=function(){return e.xhr?e.xhr.responseText:""},e.progress=function(a){void 0===a&&(a=!1);var b=a?(e.endByte-e.startByte)/e.fileObjSize:1;if(e.pendingRetry)return 0;switch(e.xhr&&e.xhr.status||(b*=.95),e.status()){case"success":case"error":return 1*b;case"pending":return 0*b;default:return e.loaded/(e.endByte-e.startByte)*b}},this}if(!(this instanceof a))return new a(b);if(this.version=1,this.support=!("undefined"==typeof File||"undefined"==typeof Blob||"undefined"==typeof FileList||!Blob.prototype.webkitSlice&&!Blob.prototype.mozSlice&&!Blob.prototype.slice),!this.support)return!1;var i=this;i.files=[],i.defaults={chunkSize:1048576,forceChunkSize:!1,simultaneousUploads:3,fileParameterName:"file",chunkNumberParameterName:"resumableChunkNumber",chunkSizeParameterName:"resumableChunkSize",currentChunkSizeParameterName:"resumableCurrentChunkSize",totalSizeParameterName:"resumableTotalSize",typeParameterName:"resumableType",identifierParameterName:"resumableIdentifier",fileNameParameterName:"resumableFilename",relativePathParameterName:"resumableRelativePath",totalChunksParameterName:"resumableTotalChunks",throttleProgressCallbacks:.5,query:{},headers:{},preprocess:null,method:"multipart",uploadMethod:"POST",testMethod:"GET",prioritizeFirstAndLastChunk:!1,target:"/",testTarget:null,parameterNamespace:"",testChunks:!0,generateUniqueIdentifier:null,getTarget:null,maxChunkRetries:100,chunkRetryInterval:void 0,permanentErrors:[400,404,415,500,501],maxFiles:void 0,withCredentials:!1,xhrTimeout:0,clearInput:!0,chunkFormat:"blob",setChunkTypeFromFile:!1,maxFilesErrorCallback:function(a,b){var c=i.getOpt("maxFiles");alert("Please upload no more than "+c+" file"+(1===c?"":"s")+" at a time.")},minFileSize:1,minFileSizeErrorCallback:function(a,b){alert(a.fileName||a.name+" is too small, please upload files larger than "+j.formatSize(i.getOpt("minFileSize"))+".")},maxFileSize:void 0,maxFileSizeErrorCallback:function(a,b){alert(a.fileName||a.name+" is too large, please upload files less than "+j.formatSize(i.getOpt("maxFileSize"))+".")},fileType:[],fileTypeErrorCallback:function(a,b){alert(a.fileName||a.name+" has type not allowed, please upload files of type "+i.getOpt("fileType")+".")}},i.opts=b||{},i.getOpt=function(b){var c=this;if(b instanceof Array){var d={};return j.each(b,function(a){d[a]=c.getOpt(a)}),d}if(c instanceof h){if(void 0!==c.opts[b])return c.opts[b];c=c.fileObj}if(c instanceof g){if(void 0!==c.opts[b])return c.opts[b];c=c.resumableObj}if(c instanceof a)return void 0!==c.opts[b]?c.opts[b]:c.defaults[b]},i.events=[],i.on=function(a,b){i.events.push(a.toLowerCase(),b)},i.fire=function(){for(var a=[],b=0;b<arguments.length;b++)a.push(arguments[b]);for(var c=a[0].toLowerCase(),b=0;b<=i.events.length;b+=2)i.events[b]==c&&i.events[b+1].apply(i,a.slice(1)),"catchall"==i.events[b]&&i.events[b+1].apply(null,a);"fileerror"==c&&i.fire("error",a[2],a[1]),"fileprogress"==c&&i.fire("progress")};var j={stopEvent:function(a){a.stopPropagation(),a.preventDefault()},each:function(a,b){if(void 0!==a.length){for(var c=0;c<a.length;c++)if(!1===b(a[c]))return}else for(c in a)if(!1===b(c,a[c]))return},generateUniqueIdentifier:function(a,b){var c=i.getOpt("generateUniqueIdentifier");if("function"==typeof c)return c(a,b);var d=a.webkitRelativePath||a.fileName||a.name;return a.size+"-"+d.replace(/[^0-9a-zA-Z_-]/gim,"")},contains:function(a,b){var c=!1;return j.each(a,function(a){return a!=b||(c=!0,!1)}),c},formatSize:function(a){return a<1024?a+" bytes":a<1048576?(a/1024).toFixed(0)+" KB":a<1073741824?(a/1024/1024).toFixed(1)+" MB":(a/1024/1024/1024).toFixed(1)+" GB"},getTarget:function(a,b){var c=i.getOpt("target");return"test"===a&&i.getOpt("testTarget")&&(c="/"===i.getOpt("testTarget")?i.getOpt("target"):i.getOpt("testTarget")),"function"==typeof c?c(b):c+(c.indexOf("?")<0?"?":"&")+b.join("&")}},k=function(a){j.stopEvent(a),a.dataTransfer&&a.dataTransfer.items?f(a.dataTransfer.items,a):a.dataTransfer&&a.dataTransfer.files&&f(a.dataTransfer.files,a)},l=function(a){a.preventDefault()},m=function(a,b){var c=0,d=i.getOpt(["maxFiles","minFileSize","maxFileSize","maxFilesErrorCallback","minFileSizeErrorCallback","maxFileSizeErrorCallback","fileType","fileTypeErrorCallback"]);if(void 0!==d.maxFiles&&d.maxFiles<a.length+i.files.length){if(1!==d.maxFiles||1!==i.files.length||1!==a.length)return d.maxFilesErrorCallback(a,c++),!1;i.removeFile(i.files[0])}var e=[],f=[],h=a.length,k=function(){if(!--h){if(!e.length&&!f.length)return;window.setTimeout(function(){i.fire("filesAdded",e,f)},0)}};j.each(a,function(a){function h(c){i.getFromUniqueIdentifier(c)?f.push(a):function(){a.uniqueIdentifier=c;var d=new g(i,a,c);i.files.push(d),e.push(d),d.container=void 0!==b?b.srcElement:null,window.setTimeout(function(){i.fire("fileAdded",d,b)},0)}(),k()}var l=a.name;if(d.fileType.length>0){var m=!1;for(var n in d.fileType){var o="."+d.fileType[n];if(-1!==l.toLowerCase().indexOf(o.toLowerCase(),l.length-o.length)){m=!0;break}}if(!m)return d.fileTypeErrorCallback(a,c++),!1}if(void 0!==d.minFileSize&&a.size<d.minFileSize)return d.minFileSizeErrorCallback(a,c++),!1;if(void 0!==d.maxFileSize&&a.size>d.maxFileSize)return d.maxFileSizeErrorCallback(a,c++),!1;var p=j.generateUniqueIdentifier(a,b);p&&"function"==typeof p.then?p.then(function(a){h(a)},function(){k()}):h(p)})};return i.uploadNextChunk=function(){var a=!1;if(i.getOpt("prioritizeFirstAndLastChunk")&&(j.each(i.files,function(b){return b.chunks.length&&"pending"==b.chunks[0].status()&&0===b.chunks[0].preprocessState?(b.chunks[0].send(),a=!0,!1):b.chunks.length>1&&"pending"==b.chunks[b.chunks.length-1].status()&&0===b.chunks[b.chunks.length-1].preprocessState?(b.chunks[b.chunks.length-1].send(),a=!0,!1):void 0}),a))return!0;if(j.each(i.files,function(b){if(!1===b.isPaused()&&j.each(b.chunks,function(b){if("pending"==b.status()&&0===b.preprocessState)return b.send(),a=!0,!1}),a)return!1}),a)return!0;var b=!1;return j.each(i.files,function(a){if(!a.isComplete())return b=!0,!1}),b||i.fire("complete"),!1},i.assignBrowse=function(a,b){void 0===a.length&&(a=[a]),j.each(a,function(a){var c;"INPUT"===a.tagName&&"file"===a.type?c=a:(c=document.createElement("input"),c.setAttribute("type","file"),c.style.display="none",a.addEventListener("click",function(){c.style.opacity=0,c.style.display="block",c.focus(),c.click(),c.style.display="none"},!1),a.appendChild(c));var d=i.getOpt("maxFiles");void 0===d||1!=d?c.setAttribute("multiple","multiple"):c.removeAttribute("multiple"),b?c.setAttribute("webkitdirectory","webkitdirectory"):c.removeAttribute("webkitdirectory");var e=i.getOpt("fileType");void 0!==e&&e.length>=1?c.setAttribute("accept",e.map(function(a){return"."+a}).join(",")):c.removeAttribute("accept"),c.addEventListener("change",function(a){m(a.target.files,a),i.getOpt("clearInput")&&(a.target.value="")},!1)})},i.assignDrop=function(a){void 0===a.length&&(a=[a]),j.each(a,function(a){a.addEventListener("dragover",l,!1),a.addEventListener("dragenter",l,!1),a.addEventListener("drop",k,!1)})},i.unAssignDrop=function(a){void 0===a.length&&(a=[a]),j.each(a,function(a){a.removeEventListener("dragover",l),a.removeEventListener("dragenter",l),a.removeEventListener("drop",k)})},i.isUploading=function(){var a=!1;return j.each(i.files,function(b){if(b.isUploading())return a=!0,!1}),a},i.upload=function(){if(!i.isUploading()){i.fire("uploadStart");for(var a=1;a<=i.getOpt("simultaneousUploads");a++)i.uploadNextChunk()}},i.pause=function(){j.each(i.files,function(a){a.abort()}),i.fire("pause")},i.cancel=function(){i.fire("beforeCancel");for(var a=i.files.length-1;a>=0;a--)i.files[a].cancel();i.fire("cancel")},i.progress=function(){var a=0,b=0;return j.each(i.files,function(c){a+=c.progress()*c.size,b+=c.size}),b>0?a/b:0},i.addFile=function(a,b){m([a],b)},i.addFiles=function(a,b){m(a,b)},i.removeFile=function(a){for(var b=i.files.length-1;b>=0;b--)i.files[b]===a&&i.files.splice(b,1)},i.getFromUniqueIdentifier=function(a){var b=!1;return j.each(i.files,function(c){c.uniqueIdentifier==a&&(b=c)}),b},i.getSize=function(){var a=0;return j.each(i.files,function(b){a+=b.size}),a},i.handleDropEvent=function(a){k(a)},i.handleChangeEvent=function(a){m(a.target.files,a),a.target.value=""},i.updateQuery=function(a){i.opts.query=a},this};"undefined"!=typeof module?module.exports=a:"function"==typeof define&&define.amd?define(function(){return a}):window.Resumable=a}();